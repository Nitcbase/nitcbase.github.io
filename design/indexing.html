<!DOCTYPE HTML>
<html>

<head>
    <title>Indexing in NITCbase</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="/fontawesome/css/solid.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <!--FAVICON-->
    <link rel="shortcut icon" type="image/png" href="/img/favicon.png" />
    
    <script type="text/javascript" src="/js/jquery-3.4.0.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js" charset="utf-8"></script>
    <!-- MATHJAX CONFIG AND SCRIPT -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX","output/HTML-CSS"],
        tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]}
      });
    </script>
    <script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js' async></script>

</head>
    
    
<body>
    
    <!-- HEADER BEGIN -->
    <header id="header">
        <nav class="navbar navbar-expand-sm fixed-top bg-dark navbar-dark">
            <div class="container">
                <a class="navbar-brand" href="/index.html">
                    <h3><span style="color:DodgerBlue">NITC</span>base</h3>
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse " id="collapsibleNavbar">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/documentation.html">Documentation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/roadmap.html">Roadmap</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about.html">About Us</a>
                    </li>
                </ul>
                </div>  
            </div>
        </nav>
    </header>
    <!-- END OF HEADER -->
    
    <!-- CONTENT BEGIN -->
    <div id="content">
        <div class="container-fluid">
            <div class="row">
                
                <!-- SIDEBAR BEGIN -->
                <div class="col-sm-2">
                    <nav class="navbar navbar-expand-sm sticky-top sticky-offset">
                        <button class="navbar-toggler sticky-top sticky-offset" type="button" data-toggle="collapse" data-target="#collapsibleSidebar">
                            <i class="fas fa-align-left"></i>
                        </button>
                        <div class="collapse navbar-collapse" id="collapsibleSidebar">
                        <ul class="nav flex-column sidemenu">
                            <li> <a href="#indexing">Understanding Indexing</a></li>
                            <li> <a href="#implementation">Implementation in NITCbase</a></li>
                          
                        </ul>
                        </div>
                    </nav>
                </div>
                <!-- END OF SIDEBAR -->
                
                <!--MAIN CONTENT START-->
                <div class="col-sm-10">
                    <div id="top">
                        <!-- PAGE STARTS -->
                        <div class="pagetitle">
                            <h1>Indexing in NITCbase</h1>
                        </div>
                        
                            
                            <div class="detail" id="indexing">
                                <h2>Understanding Indexing</h2>
                                
                                <p>

                                On creating a database of your own, it is essential that we have access to the data stored without much time delay. Disk access is a high-latency operation. Therefore, as the size of relations increases, searching records that satisfy certain conditions by accessing every record in the disk blocks can adversely affect the performance. This necessitates indexing.
                                </p>
                                <p>Creating an index enables us to access the required entry with very few disk accesses. Indices are access structures that are used to speed up the retrieval of records in response to certain search conditions. The index structures are additional files on disk that provide secondary access paths, which provide alternative ways to access the records without affecting the physical placement of records. An index in a database is very much like the index in a book. And, just as a book's index points to locations within the book, a database's index points to records within the disk. The database organizes the indexes such that these pointer values can be found extremely fast. And, once the database has located a desired set of pointer values, it can then turn around and quickly read the full record. So, in the end, a database index is a means to locate and read table data as quickly as possible.</p>
                                <p>So, an index is a collection of attribute values and their corresponding record pointers.
                                When designing an index, the structure of the index determines how fast the index can be accessed and what kind of queries can leverage it.
                            
                                Perhaps one of the most common type of index structure is the B+ Tree. It is a self-balancing, sorted variation on the binary tree structure that stores the index values in a relatively shallow but wide shape. The sorted nature of the B+ Tree lends itself well to range-based scanning and sequential access as well as equality-based access. NITCbase uses B+ Tree for indexing records. </p>
                                <div class="card">
                                <div class="card-header">
                                <!--<div class="card-body">-->
                                <b>Click <a href="Bplustreedetails.html">here</a> to develop a thorough understanding of B+ Tree before you proceed with its implementation in NITCbase.</b>
                                </div>
                                </div>
                                <br>
                                <p>Let us understand indexing in NITCbase with an example. <br>Consider a relation of 10 attributes containing 12,000 records.
                                The<b> Record block </b>size is <b>2048 </b>bytes. (Refer <a href="../storage-model.html">Physical Layer</a>)<br>
                                Number of slots (Maximum number of records, L) that fits in a block for any given relation can be calculated as:</p>

                                <b><p> \[ 
                                
                                \#Slots = L = \left \lfloor \frac {2048 - 32} {((16 * \#Attributes(K)) + 1)} \right \rfloor \\
                                       = \left \lfloor \frac {2016} {((16 * 10 + 1)} \right \rfloor = 12
                                \]</p></b>

                                <p>Therefore, the number record blocks required to store the given relation is: </p>

                                <b><p> \[ 
                                
                                \#Record Blocks = \left \lceil \frac {12000} {12} \right \rceil = 1000
                                       
                                \]</p></b>
                                <p>This implies that the number of disk accesses required to process a query in the absence of index is <b>1000</b>.<br>Suppose, we have a query based on a indexed attribute satisfying certain condition. In NITCbase, the maximum number of entries in an Internal index block and Leaf index block are 100 and 63 respectively. Similarly, the minimum number of entries are 50 and 32 respectively. We know that all the attribute values appear in any of the leaf blocks. So the maximum number of Leaf index blocks is:</p>

                                <b><p> \[ 
                                
                                \#Leaf Index Blocks = \left \lceil \frac {12000} {32} \right \rceil = 375
                                       
                                \]</p></b>
                                <p>

                                Given that the minimum number of Internal Index block entries being 50, the minimum number of children is 51.
                                Therefore, the maximum depth of the B+ Tree is :</p>

                                <b><p> \[ 
                                
                                \#Height = \left \lceil \log_{51} {375}  \right \rceil = 2
                                       
                                \]</p></b>
                                <p>So, the total number number of disk accesses required is 2+1= <b>3</b>.<br>We notice that from 1000 disk accesses to 3 disk accesses, the performance increase is substantial.</p>
                                




                               
                        
                        </div>     
                                 
                        <div id="implementation" class="detail">
                            <h2>B+Tree Implementation in NITCbase</h2>
                            <p>Consider a Relation<b> Student (Name, Roll No, Batch, Marks) </b>with 4 attributes.</p>
                            <center><img class="img-fluid" src="../img/indexing/Table.png"></center>
                            <p>For simplicity, we have taken the size of Record Block as 320 bytes analogous to 2048 bytes in NITCbase. Therefore, keeping all other factors same, the number of slots per block would be 4. Given Relation has 14 records. Hence number of Record blocks required is 4.<br> The Record Block structure is as follows :</p>

                            <center><img class="img-fluid" src="../img/indexing/recordblk.png"></center>
                            <br>
                            <p>The maximum number of entries in Internal index block and Leaf index block are taken to be <b>4</b> and <b>3</b> respectively analogous to <b>100 </b>and <b>63</b> in NITCbase.<br>
                           We need to create an Index for the <b>attribute RollNo</b>. As discussed in <a href="../storage-model.html">Physical Layer</a>, each <b>Attribute Catalog entry</b> contains the <b>Root block Index</b> which stores the root block number of the B+ Tree if there is an index created on the attribute; and contains -1 otherwise</p>
                           <center><img class="img-fluid" src="../img/indexing/attrcat1.png"></center>
                           <p>In order to create the Index, we begin by getting a free Leaf index block, say <b>L1</b> allocated for the root block. (Why?) <br> 
                            We then update the Root Block in the Attribute Catalog Entry.
                            </p>
                            <center><img class="img-fluid" src="../img/indexing/attrcat2.png"></center>
                            <p>We need to insert the following set of key values of the attribute RollNo with respect to each row of the table in a sequential manner.<br>
                            <b>1,3,8,7,6,4,11,13,10,9,5,12,14,2 </b> <br>
                            The algorithmic procedure for <b>insertion</b> is given below:

                            </p>




                           <h5><b><span class="fas fa-code"></span>Algorithm:</h5></b>
                             <div id="algo-create" >
                                <div class="code"><code>
                                    <ol>
                                        <li>Find the correct Leaf index block, say X where the key value has to be inserted by traversing down the tree starting from the Root Block.</li>
                                        <li>Create a temporary array of indices containing entries of X. Insert the entry corresponding to the key value in the array maintaining sorted order.</li>
                                        <ol>
                                            <li>If the size of indices array<=3 on insertion, i.e leaf is not full, overwrite the Leaf index block X with entries of array.</li>
                                            <li>If the size of indices array=4, i.e leaf is full, get a new free Leaf index block, say Y. Distribute the entries in indices array evenly between X and Y. X contains first two entries. Y contains next 2 entries. We must add a new entry to the parent block, say P with child pointers to X and Y . The last value of X is to be added to P, considering a left biased B+Tree. (P=parent of X)</li>
                                            <ul>
                                                <li>If X does not have a parent block: </li>
                                                <ol>
                                                    <li>Get a new free Internal index block, i.e P and insert the new entry.This is the case when root was split. P is the new Root block. Update the attribute catalog entry accordingly.</li>
                                                </ol>
                                                <li>Else</li>
                                                <ol>
                                                    <li>Insert the new entry in P using a temporary array indices containing entries of P, maintaining sorted order.</li>
                                                    <li>If the size of indices array=5 on insertion of new entry, get a new free Internal index block, say Q. Insert the first and last 2 entries in P and Q respectively. Also, insert the middle entry in the parent block above with child pointers to  P and Q (Why?  to propagate key values up the tree) by repeating the algorithm after step 2. (X=P, P=parent block of P)</li>
                                                </ol>
                                                
                                            </ul>
                                        </ol>
                                    </ol>

                                </code>
                                </div>
                            </div>

                            <div class="question">
                                <div class="card">
                                    <div class="card-header">
                                        <a data-toggle="collapse" href="#collapse1">
                                            <b>Insert 1,3,8</b> 
                                        </a>
                                    </div>
                                    <div id="collapse1" class="collapse">
                                        <div class="card-body"> 
                                        <center><img class="img-fluid" src="../img/indexing/1.png"></center>
                                        <center><img class="img-fluid" src="../img/indexing/01.JPG"></center>  
When 1 is to be inserted , foremost the attribute catalog entry is obtained from the cache layer. The root block number of the attribute is checked and since it is not -1 , we proceed further. We obtain a free buffer for the block containing the entry. The first entry will always be a leaf entry. <br>

A temporary array of indices containing the entry is created. The purpose of the array is to ensure all the entries are in a sorted order. Since the size of the array is less than three ,we rewrite the entries of the leaf index block in the sorted order from the array. The header of the block will be updated. <br>

Similarly 3 and 8 are inserted. The pblock value remains -1 throughout these insertions as there is no parent block introduced in the B+ tree yet.                                         
                                        </div>
                                    </div>
                                </div>
                            
                                <div class="card">
                                    <div class="card-header">
                                        <a data-toggle="collapse" href="#collapse2">
                                            <b>Insert 7</b> 
                                        </a>
                                    </div>
                                    <div id="collapse2" class="collapse">
                                        <div class="card-body">
                                        <center><img class="img-fluid" src="../img/indexing/2.png"></center>
                                        <center><img class="img-fluid" src="../img/indexing/02.JPG"></center> 



<p>When the entry 7 is to be inserted , the entries are sorted in the array however it cannot be inserted or written into the same block L1 as now the existing leaf block has 3 entries i.e the leaf block is full. A new leaf block is hence obtained. </p>

<p>Iterate through all the sorted four entries. The first two entries (the half of the entries) are set in the current block L1 and the next two entries are set in the new leaf block L2. The headers of the both the blocks are updated to incorporate the changes.The RBlock value of L1 is set as L2 and the LBlock value of L2 is set as L1. This is to maintain a linked list of leaf blocks. </p>

<p>A parent block is now required since there has been a split. A new internal index block I1 is obtained for the same. The last value of the first block obtained on splitting the node , in this example the value 3 is made the entry of the internal index block. This also does not violate the requirement that the maximum number of entries in an internal index block is four. </p>

<p>The left and right child of this new internal index block is set as L1 and L2 respectively. The parent block value in the header of these child blocks are updated as I1. </p>

The attribute catalog in the physical layer will be updated with the changes.
                                                                                 
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        <a data-toggle="collapse" href="#collapse3">
                                            <b>Insert 6</b> 
                                        </a>
                                    </div>
                                    <div id="collapse3" class="collapse">
                                        <div class="card-body">       
                                        <center><img class="img-fluid" src="../img/indexing/3.png"></center>
                                        <center><img class="img-fluid" src="../img/indexing/03.JPG"></center> 

When 6 is to be inserted ,we traverse down the tree starting from the root block I1 to find the appropriate leaf index block. Since 6 is greater the 3 , we traverse down to the right child of I1. As seen previously , the entries are sorted and since the maximum number of entries in a leaf block is not violated , the entries including the new entry 6 is written back into the block L2 and the number of entries in the header of L2 is updated. 
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        <a data-toggle="collapse" href="#collapse4">
                                            <b>Insert 4</b> 
                                        </a>
                                    </div>
                                    <div id="collapse4" class="collapse">
                                        <div class="card-body">
                                            <center><img class="img-fluid" src="../img/indexing/4.jpg"></center>
                                            <center><img class="img-fluid" src="../img/indexing/04.JPG"></center>
<p>When 4 is to be inserted ,we traverse down the tree starting from the root block I1 to find the appropriate leaf index block. Since 4 is greater the 3 , we traverse down to the right child of I1. The entries are sorted however in this case the number of entries in the leaf block will become greater than three if the entry 4 is to be included in L2. Hence a new leaf block L3 is introduced. The first half of the sorted entries in the array (4,6) are set in L2 and the rest (7,8) are set in L3. The LBlock and RBlock values of the headers of the blocks are updated to maintain the linked list. </p>

<p>Since L2 already has a parent block I1 and the number of entries in the parent block is less than four , we take the last value in the current L2 and the current entry in I1 into a temporary array for the purpose of sorting. The sorted entries are then written back into I1 and the number of entries in I1 is incremented. The left and right child of the new entry 6 in the parent block is set as L2 and L3 respectively. </p>

<p>The parent block of L3 is set as I1.</p>
                                            
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        <a data-toggle="collapse" href="#collapse5">
                                            <b>Insert 11</b> 
                                        </a>
                                    </div>
                                    <div id="collapse5" class="collapse">
                                        <div class="card-body">
                                            <center><img class="img-fluid" src="../img/indexing/5.jpg"></center>
                                            <center><img class="img-fluid" src="../img/indexing/05.JPG"></center>

When 11 is to be inserted ,we traverse down the tree starting from the root block I1 to find the appropriate leaf index block. Since 11 is greater than 6 , we traverse down to the right child of 6 in I1. The entries in L3 along with the new entry 11 are sorted in a temporary array and since the maximum number of entries in a leaf block is not violated , the entries are written back into the block L3 and the number of entries in the header of L3 is updated.
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        <a data-toggle="collapse" href="#collapse6">
                                            <b>Insert 13</b> 
                                        </a>
                                    </div>
                                    <div id="collapse6" class="collapse">
                                        <div class="card-body">
                                            <center><img class="img-fluid" src="../img/indexing/6.jpg"></center>
                                            <center><img class="img-fluid" src="../img/indexing/06.JPG"></center>

<p>When 13 is to be inserted ,we traverse down the tree starting from the root block I1 to find the appropriate leaf index block. Since 13 is greater the 6 , we traverse down to the right child of 6 in I1. The entries are sorted however in this case the number of entries in the leaf block L3 will become greater than three if the entry 13 is to be included. Hence a new leaf block L4 is introduced. The first half of the sorted entries in the array (7,8) are set in the block L3 and the rest (11,13) are set in L4. The LBlock and RBlock values of the headers of the blocks are updated to maintain the linked list. </p>

<p>Since L3 already has a parent block I1 and the number of entries in the parent block is less than four , we take the last value in the current L3 and the current entries in I1 into a temporary array for the purpose of sorting. The sorted entries are then written back into I1 and the number of entries in I1 is incremented. The left and right child of the entry 8 in the parent block are set as L3 and L4 respectively.</p>

<p>The parent block of L4 is set as I1.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        <a data-toggle="collapse" href="#collapse7">
                                            <b>Insert 10</b> 
                                        </a>
                                    </div>
                                    <div id="collapse7" class="collapse">
                                        <div class="card-body">
                                            <center><img class="img-fluid" src="../img/indexing/7.jpg"></center>
                                            <center><img class="img-fluid" src="../img/indexing/07.JPG"></center>


When 10 is to be inserted ,we traverse down the tree starting from the root block I1 to find the appropriate leaf index block. Since 10 is greater than 8 , we traverse down to the right child of 8 in I1. The entries in L4 along with the new entry 10 are sorted in a temporary array and since the maximum number of entries in a leaf block is not violated , the entries are written back into the block L4 and the number of entries in the header of L4 is updated.
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        <a data-toggle="collapse" href="#collapse8">
                                            <b>Insert 9</b> 
                                        </a>
                                    </div>
                                    <div id="collapse8" class="collapse">
                                        <div class="card-body">
                                            <center><img class="img-fluid" src="../img/indexing/8.jpg"></center>
                                            <center><img class="img-fluid" src="../img/indexing/08.JPG"></center>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        <a data-toggle="collapse" href="#collapse9">
                                            <b>Insert 5</b> 
                                        </a>
                                    </div>
                                    <div id="collapse9" class="collapse">
                                        <div class="card-body">
                                            <center><img class="img-fluid" src="../img/indexing/9.jpg"></center>
                                            <center><img class="img-fluid" src="../img/indexing/09.JPG"></center>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        <a data-toggle="collapse" href="#collapse10">
                                            <b>Insert 12</b> 
                                        </a>
                                    </div>
                                    <div id="collapse10" class="collapse">
                                        <div class="card-body">
                                         <center><img class="img-fluid" src="../img/indexing/10.jpg"></center>
                                         <center><img class="img-fluid" src="../img/indexing/010.JPG"></center>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        <a data-toggle="collapse" href="#collapse11">
                                            <b>Insert 14 and then 2</b> 
                                        </a>
                                    </div>
                                    <div id="collapse11" class="collapse">
                                        <div class="card-body">
                                            <center><img class="img-fluid" src="../img/indexing/11.jpg"></center>
                                            <center><img class="img-fluid" src="../img/indexing/011.JPG"></center>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            

                                
                       </div>
                        <!-- PAGE ENDS -->
                    </div>
                </div>
                <!-- END OF MAIN CONTENT -->
            </div>
        </div>
        
    </div>
    <!-- END OF CONTENT -->
</body>

</html>
